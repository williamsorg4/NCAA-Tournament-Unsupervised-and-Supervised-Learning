---
title: "Project 2 - Tournament Unsupervised and Supervised Learning"
author: "William Sorg.74"
date: "2025-04-08"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stringr)
library(tidyverse)
library(cbbplotR)
library(ggrepel)
library(ggstatsplot)

mm2002_2025 <- as_tibble(read.csv("mm2002_2025.csv"))
wins <- readRDS("C:/Users/William Sorg/OneDrive - The Ohio State University/SP25/STAT 4194 - Sports Statistics/Project 2 - NCAA Tournament Unsupervised and Supervised Learning/wins.rds")
```

# Data Selection

The data that I will be focusing my analysis on is a subset of the mm2002_2025.csv file. I removed all duplicate and redundant rows, then selected a subset of variables that I believe may be important. I also scraped the number of wins each team had in the tournament from [sports-reference.com](https://www.sports-reference.com/cbb/postseason/men/2025-ncaa.html) and joined this with the existing data.

```{r dataSelection, echo=FALSE, warning=FALSE, message=FALSE}
mmdata <- mm2002_2025 %>% 
  select(Mapped.ESPN.Team.Name, Season, Seed, Region,
         Short.Conference.Name, Post.Season.Tournament,
         Tournament.Winner., Tournament.Championship., Final.Four.,
         AdjTempo, AdjOE, AdjDE, AdjEM, eFGPct, TOPct, ORPct, FTRate,
         OffFT, Off2PtFG, Off3PtFG, FG3Pct, FTPct, DefFT, Def2PtFG,
         Def3PtFG, BlockPct, OppFG3Pct, FG3Rate, ARate, AvgHeight,
         CenterHeight, Experience, Bench, PGPts, SGPts, SFPts, PFPts,
         CenterPts, Net.Rating, Active.Coaching.Length) %>% 
  rename("Team" = `Mapped.ESPN.Team.Name`,
         "Conference" = Short.Conference.Name) %>% 
  mutate(Active.Coaching.Length = as.integer(gsub(" years", "", Active.Coaching.Length))) %>% 
  filter(Post.Season.Tournament == "March Madness") %>% 
  left_join(wins) %>% 
  mutate(wins = case_when(is.na(wins) ~ 0,
                          .default = wins),
         Seed = as.integer(Seed),
         Champ = Tournament.Winner. == 'Yes',
         Finals = Tournament.Championship. == "Yes",
         FinalFour = Final.Four. == "Yes") %>% 
  select(1:4, 41:44, 5, 10:40) %>% 
  arrange(desc(Season), Region, Seed)

head(mmdata)
```

\newpage
# Exploratory Analysis

As expected, seed and tournament wins have a strong relationship. However, this relationship is the strongest for top seeds and tapers off for higher seeded teams. I was also curious if some teams are "built for March," so I looked at how teams performed compared to their seeds. While this isn't the most accurate metric since coaches matter more than the logo, it still gives some idea of how programs have performed in March Madness.

\vspace{12pt}
```{r EA1, echo=FALSE, message=FALSE, out.width="50%"}
mmdata %>% 
  ggplot(aes(x = Seed, y = wins)) +
  geom_smooth() +
  geom_jitter(height = 0) +
  labs(title = "Relationship between Tournament Wins and Seed") +
  ylab("Tournament Wins") +
  theme_minimal()+
  theme(plot.title = element_text(face = 'bold'))

mmdata <- mmdata %>% 
  left_join(mmdata %>% summarise(avgwins = mean(wins), .by = Seed)) %>% 
  mutate(winsOveravg = wins - avgwins) %>% 
  select(-avgwins)

teamsOfInterest <- mmdata %>% 
  filter(Season != 2025) %>% 
  summarise(`Average Wins over Seed Average` = mean(winsOveravg),
            Appearances = n(), .by = Team) %>% 
    filter(Team %in% mmdata$Team[mmdata$Season == 2025]) %>% 
    filter(abs(`Average Wins over Seed Average`) > 0.5)

mmdata %>% 
  filter(Season != 2025) %>% 
  summarise(`Average Wins over Seed Average` = mean(winsOveravg),
            Appearances = n(), .by = Team) %>% 
  ggplot(aes(x=`Average Wins over Seed Average`, y = Appearances)) +
  geom_point(alpha = 0.75) +
  geom_cbb_teams(data = teamsOfInterest, aes(team = Team), width = 0.05)+
  labs(title = "Do Certain Teams Consistently Under or Over Achieve?",
       subtitle = "2025 Tournament Teams who have performed greater or less than half a win off \naverage are labelled.") +
  theme_minimal()+
  theme(plot.title = element_text(face = 'bold'))
```
\vspace{12pt}

Based on the charts above, ACC teams tend to perform the best out of major conferences since 2002. There isn't a large difference in average tournament wins, but wins over seed average sees a wider range. I am surprised that the Big 12 under performs based on seed though.

\vspace{12pt}
```{r EA2, echo=FALSE, message=FALSE, out.width="50%"}
mmdata %>% 
  filter(Conference %in% c("ACC", "SEC", "B10", "B12", "BE"),
         Season != 2025) %>% 
  summarise(avgwins = mean(wins), .by = Conference) %>% 
  ggplot(aes(x = Conference, y = avgwins, fill = Conference)) +
  geom_col() +
  labs(title = "Average Tournament Wins by Conference") +
  ylab("Average Tournament Wins") +
  scale_fill_cbb_conferences() +
  theme_minimal() +
  theme(axis.text.x = element_cbb_conferences(size = 0.5))+
  theme(plot.title = element_text(face = 'bold'))

mmdata %>% 
  filter(Conference %in% c("ACC", "SEC", "B10", "B12", "BE"),
         Season != 2025) %>% 
  summarise(avgwins = mean(winsOveravg), .by = Conference) %>% 
  ggplot(aes(x = Conference, y = avgwins, fill = Conference)) +
  geom_col() +
  labs(title = "Average Wins Over Seed Average by Conference") +
  ylab("Average Wins Over Seed Average") +
  scale_fill_cbb_conferences() +
  theme_minimal() +
  theme(axis.text.x = element_cbb_conferences(size = 0.5))+
  theme(plot.title = element_text(face = 'bold'))
```
\newpage

Adjusted Tempo doesn't seem to have much of an impact on tournament wins, but offensive and defensive efficiency, as well as their difference, do seem to have a significant relationship with tournament success.

\vspace{12pt}
```{r EA3, echo=FALSE, message=FALSE}
mmdata %>% 
  filter(Season != 2025) %>% 
  pivot_longer(cols = 10:13, names_to = "Statistic", values_to = "Value") %>% 
  ggplot(aes(x = Value, y = wins)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Relationship between Adjusted Stats and Tournament Wins") +
  ylab("Tournament Wins") +
  facet_wrap(~Statistic, scales = 'free_x') +
  theme_minimal()+
  theme(plot.title = element_text(face = 'bold'))
```
\vspace{12pt}

Net Rating appears to be a great predictor of tournament success while coaching experience does not. This is not surprising considering this years national championship game saw a 69 year old face a 39 year old.

\vspace{12pt}
```{r EA4, echo=FALSE, message=FALSE, out.width="50%", warning=FALSE}
mmdata %>% 
  filter(Season != 2025) %>% 
  ggplot(aes(x = Net.Rating, y = wins)) +
  geom_point() +
  geom_smooth() +
  xlab("Net Rating") +
  ylab("Tournament Wins") +
  labs(title = "Net Rating's Relationship with Tournament Wins") +
  theme_minimal()+
  theme(plot.title = element_text(face = 'bold'))

mmdata %>% 
  filter(Season != 2025) %>% 
  ggplot(aes(x = Active.Coaching.Length, y = wins)) +
  geom_jitter(height = 0, alpha = 0.5) +
  geom_smooth() +
  xlab("Coaching Experience") +
  ylab("Tournament Wins") +
  labs(title = "The Impact of Coaching Experience on Tournament Success")+
  theme_minimal()+
  theme(plot.title = element_text(face = 'bold'))
```
\newpage

Given these correlograms, there appears to be no linear relationship between wins and many of these stats. However, offensive rebounding percentage, turnover percentage, effective field goal percentage, opponent 3-point field goal percentage, block percentage, center height, and average height all have a weak correlation with tournament wins.

\vspace{12pt}
```{r EA5, echo=FALSE, message=FALSE, out.width="50%", warning=FALSE}
mmdata %>%
  filter(Season != 2025) %>% 
  ggcorrmat(cor.vars = c(wins, 14:20))
mmdata %>% 
  filter(Season != 2025) %>% 
  ggcorrmat(cor.vars = c(wins, 21:27))
mmdata %>% 
  filter(Season != 2025) %>% 
  ggcorrmat(cor.vars = c(wins, 28:33))
```
\vspace{12pt}

There isn't an extreme relationship between tournament wins and either team experience or bench production, but what is shown is that teams that are extreme in these categories don't tend to have success.

\vspace{12pt}
```{r EA6, echo=FALSE, message=FALSE, out.width="50%", warning=FALSE}
mmdata %>% 
  filter(Season != 2025) %>% 
  ggplot(aes(x = Experience, y = wins)) +
  geom_point(alpha = 0.25) +
  geom_density2d() +
  labs(title = "Tournament Wins versus Team Experience") +
  xlab("Team Experience") +
  ylab("Tournament Wins") +
  theme_minimal() +
  theme(plot.title = element_text(face = 'bold'))

mmdata %>% 
  filter(Season != 2025) %>% 
  ggplot(aes(x = Bench, y = wins)) +
  geom_point(alpha = 0.25) +
  geom_density2d() +
  labs(title = "Tournament Wins versus Bench Production") +
  xlab("Bench Production") +
  ylab("Tournament Wins") +
  theme_minimal() +
  theme(plot.title = element_text(face = 'bold'))
```
\newpage


While positional scoring doesn't seem to have a relationship with tournament wins, all national champions appear to have somewhat balanced scoring.

\vspace{12pt}
```{r EA7, echo=FALSE, message=FALSE, out.width="50%", warning=FALSE}
mmdata %>% 
  filter(Season != 2025) %>% 
  pivot_longer(cols = 34:38, names_to = "Position", values_to = "Pts") %>% 
  ggplot(aes(x = Pts, y = wins, color = Position)) +
  geom_point(alpha = 0.1) +
  geom_smooth() +
  scale_color_brewer(palette = "Dark2") +
  labs(title = "Tournament Wins versus Positional Scoring") +
  xlab("Points Scored") +
  ylab("Tournament Wins") +
  theme_minimal() +
  theme(plot.title = element_text(face = 'bold'))

mmdata %>% 
  filter(Season != 2025) %>% 
  pivot_longer(cols = 34:38, names_to = "Position", values_to = "Pts") %>% 
  ggplot(aes(y = Champ, x = Pts, color = Position)) +
  geom_jitter(width = 0, height = 0.2, alpha = 0.75) +
  scale_color_brewer(palette = "Dark2") +
  xlab("Points") +
  ylab("National Champion") +
  labs(title = "Scoring Distribution for National Champions") +
  theme_minimal() +
  theme(plot.title = element_text(face = 'bold'))
```
\vspace{12pt}

# Unsupervised Learning

## K-means

```{r kmeans}

```


